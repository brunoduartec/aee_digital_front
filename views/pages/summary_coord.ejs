<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/head'); %>
  </head>
  <body class="body">
    <%- include('../partials/quiz_validate');%>
    <header class="cabeçalho"><%- include('../partials/header'); %></header>
    <div class="cadastrar-titulo">
      <h2>Validação de Informações</h2>
    </div>
    <div class="validacao-coord-subtitulo">
      <h3>Regional <%= regionalInfo.NOME_REGIONAL%></h3>
      <p><b> Coordenador:<%= coordenador.NOME%></b></p>
      <p><b> Quantidade de Casas:<%=centros.length%></b></p>
      <div class="form row">
        <span class="border col-md-12"
          ><div class="form-group">
            <p><b>Observações da Secretaria:</b></p>
          </div></span
        >
      </div>
      <br />
    </div>
    <%
    totalRespostas = Object.keys(responses).length
    totalCentros = centros.length
    porcentagemRespostas = 100*totalRespostas/totalCentros
    porcentagemRespostasFaltantes = 100 - porcentagemRespostas

    
    %>
    <div class="validacao-coord-dados">
      <div class="form row">
        <span class="border col-md-12"
          ><div class="form-group" style="color: #0d6efd">
            <p><b>Status das Atualizações </b></p>
          </div></span
        >
        <span class="border col-md-4"
          ><div class="form-group" style="color: #0d6efd">
            <p><b>Situação das Casas</b></p>
          </div></span
        >
        <span class="border col-md-8"
          ><div class="form-group" style="color: #0d6efd">
            <p><b>Situação do Coordenador</b></p>
          </div></span
        >
      </div>
      <div class="form row">
        <span class="border col-md-2"
          ><div class="form-group">
            <p><b>Atualizadas</b></p>
          </div></span
        >
        <span class="border col-md-2"
          ><div class="form-group" style="color: red">
            <p><b>Pendentes</b></p>
          </div></span
        >
        <span class="border col-md-2"
          ><div class="form-group">
            <p><b>Integradas</b></p>
          </div></span
        >
        <span class="border col-md-2"
          ><div class="form-group">
            <p><b>Inscritas</b></p>
          </div></span
        >
        <span class="border col-md-2"
          ><div class="form-group" style="color: red">
            <p><b>Pendentes</b></p>
          </div></span
        >
        <span class="border col-md-2"
          ><div class="form-group">
            <p><b>Desfiliadas</b></p>
          </div></span
        >
      </div>
      <div class="form row">
        <span class="border col-md-2"
          ><div class="form-group"><p><%=totalRespostas%></p></div></span
        >
        <span class="border col-md-2"
          ><div class="form-group"><p><%=totalCentros - totalRespostas%></p></div></span
        >
        <span class="border col-md-2"
          ><div class="form-group"><p id="Integradas">0</p></div></span
        >
        <span class="border col-md-2"
          ><div class="form-group"><p id="Inscritas">0</p></div></span
        >
        <span class="border col-md-2"
          ><div class="form-group"><p id="Pendentes">0</p></div></span
        >
        <span class="border col-md-2"
          ><div class="form-group"><p id="Desfiliadas">0</p></div></span
        >
      </div>
      <div class="form row">
        <span class="border col-md-2"
          ><div class="form-group"><p><%=Math.round(porcentagemRespostas)%>%</p></div></span
        >
        <span class="border col-md-2"
          ><div class="form-group"><p><%=100 - Math.round(porcentagemRespostas)%>%</p></div></span
        >
        <span class="border col-md-2"
          ><div class="form-group"><p id="Integradas_percent">0%</p></div></span
        >
        <span class="border col-md-2"
          ><div class="form-group"><p id="Inscritas_percent">0%</p></div></span
        >
        <span class="border col-md-2"
          ><div class="form-group"><p>0%</p></div></span
        >
        <span class="border col-md-2"
          ><div class="form-group"><p>0%</p></div></span
        >
      </div>
      <br />

      <div class="form row">
        <span class="border col-md-12"
          ><div class="form-group" style="color: #0d6efd">
            <p><b>Atualização pelo Coordenador </b></p>
          </div></span
        >
      </div>
      <div class="form row">
        <span class="border col-md-4"
          ><div class="form-group">
            <p><b>Nome da Casa:</b></p>
          </div></span
        >
        <span class="border col-md-1"
          ><div class="form-group">
            <p><b>Apelido</b></p>
          </div></span
        >
        <span class="border col-md-1"
          ><div class="form-group">
            <p><b>Tipo </b></p>
          </div></span
        >
        <span class="border col-md-2"
          ><div class="form-group" style="color: red">
            <p><b>Situação</b></p>
          </div></span
        >
        <span class="border col-md-2"
          ><div class="form-group">
            <p><b> Part. Reuniões (%)</b></p>
          </div></span
        >
        <span class="border col-md-2"
          ><div class="form-group">
            <p><b>Data da Avaliação</b></p>
          </div></span
        >
      </div>

      <% centros.forEach(function(centro) { 
        
        %>
        <%if(responses[centro.NOME_CENTRO]){%>
          <div class="form row " style="background-color:rgb(71, 255, 126);">
            <%}else{%>
              <div class="form row " style="background-color:Tomato;">
          <%}%>
        <span class="border col-md-4"
          ><div class="form-group"><p><%=centro.NOME_CENTRO%></p></div></span
        >
        <span class="border col-md-1"
          ><div class="form-group"><p><%=centro.NOME_CURTO%></p></div></span
        >
        <span class="border col-md-1"
          ><div class="form-group"><p>Antiga/ Nova</p></div></span
        >
        
        <span class="border col-md-2"
          ><div class="form-group" name="prop_0">
            <%
            questionInfo = templates[centro.NOME_CENTRO][0]
            %>
            <%- include('../partials/sub_quiz_option', {question:questionInfo});%>
          </div>
        </span>
        <span class="border col-md-2"
          ><div class="form-group" name="prop_1"><p>
            <%
            questionInfo = templates[centro.NOME_CENTRO][1]
            %>
            <%- include('../partials/sub_quiz_input', {question:questionInfo});%></p></div></span
        >
        <span class="border col-md-2"
          ><div class="form-group"><p>
            <%if(responses[centro.NOME_CENTRO]){%>
                <%=new Date(responses[centro.NOME_CENTRO][0].LASTMODIFIED).toLocaleString()%>
              <%}else{%>
                Não Finalizado
              <%}%>
          </p></div></span>
      </div>

      <%});%>

      <br />
  
    <br />

      <script>

        function setSummaryInfo(data){
          let integradas = document.getElementById("Integradas");
            
            let integradasAmount = data.Integradas.length
            let inscritasAmount = data.Inscritas.length

            integradas.innerText = Math.round(integradasAmount)
            let inscritas =  document.getElementById("Inscritas");
            inscritas.innerText = Math.round(inscritasAmount)
            
            
            let  percent = 100* integradasAmount / (integradasAmount + inscritasAmount)
            let Integradas_percent = document.getElementById("Integradas_percent");
            Integradas_percent.innerText = Math.round(percent).toString().concat("%")
            let inscritas_percent =  document.getElementById("Inscritas_percent");
            inscritas_percent.innerText = Math.round(100 - percent).toString().concat("%")
        }

        function checkSituacao(nomeRegional){

          const prop_0 = document.getElementsByName("prop_0")
          const prop_1 = document.getElementsByName("prop_1")

          console.log(prop_0.length)
          console.log(prop_0[0].children[0])
          console.log(prop_0[0].children[0].value)

          let data = {
            Integradas:[{}],
            Inscritas:[{}]
          }

          
          for (const iterator of prop_0) {
            const value = iterator.children[0].value
            data[`${value}s`].push(iterator.children[0])
          }
          
          setSummaryInfo(data)
        }

        var intervalId = window.setInterval(function(){
          /// call your function here
          checkSituacao("<%=regionalInfo.NOME_REGIONAL %>")
        }, 5000);
        </script>

    <footer><%- include('../partials/footer'); %></footer>
  </body>
</html>
